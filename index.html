<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bellade Tool</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <form id="bereken-form">
    <input name="vermogen" type="number" placeholder="Vermogen (kW)" value="80" />
    <input name="opstartkost" type="number" placeholder="Opstartkost" value="15000" />
    <input name="huurprijs" type="number" placeholder="Huurprijs" value="1095" />
    <input name="huurprijs_later" type="number" placeholder="Huurprijs vanaf maand 61" value="275" />
    <input name="starttarief" type="number" placeholder="Starttarief per sessie" value="2" />
    <input name="kwhprijs" type="number" placeholder="kWh-Verkoopprijs" value="0.7" />
    <input name="parkeertarief" type="number" placeholder="Parkeertarief" value="1" />
    <input name="laadsessies" type="number" placeholder="Aantal laadsessies per dag" value="2" />
    <input name="kostprijsenergie" type="number" placeholder="Kostprijs energie" value="0.2" />
    <input name="maandstijging" type="number" placeholder="Gemiddelde maandelijkse stijging (%)" value="0.005" />
    <input name="verbruik_per_sessie" type="number" placeholder="Verbruik per sessie (kWh)" value="39" />
    <button type="button" onclick="berekenEnToonResultaten()">Start calculatie</button>
  </form>

  <div>
    <p>Omzet: <span id="omzet"></span></p>
    <p>Energiekost: <span id="energiekost"></span></p>
    <p>Capaciteitskost: <span id="capaciteitskost"></span></p>
    <p>Huurprijs: <span id="huurprijs"></span></p>
    <p>Verkochte energie: <span id="energiehoeveelheid"></span></p>
    <p>Terugverdentijd: <span id="terugverdentijd"></span></p>
    <p>Jaarlijks rendement: <span id="jaarlijksrendement"></span></p>
  </div>

  <canvas id="barChart" width="400" height="200"></canvas>
  <canvas id="lineChart" width="600" height="300"></canvas>

  <script>
  async function berekenEnToonResultaten() {
    const formData = new FormData(document.getElementById('bereken-form'));
    const data = Object.fromEntries(formData);
    const response = await fetch('/bereken', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });
    const resultaat = await response.json();

    document.getElementById('omzet').textContent = resultaat.omzet + ' €';
    document.getElementById('energiekost').textContent = resultaat.energiekost + ' €';
    document.getElementById('capaciteitskost').textContent = resultaat.capaciteitskost + ' €';
    document.getElementById('huurprijs').textContent = resultaat.huurprijs + ' €';
    document.getElementById('energiehoeveelheid').textContent = resultaat.energiehoeveelheid + ' kWh';
    document.getElementById('terugverdentijd').textContent = resultaat.terugverdentijd + ' maanden';
    document.getElementById('jaarlijksrendement').textContent = resultaat.rendement_jaarlijks + ' %';

    if (window.barChart) window.barChart.destroy();
    window.barChart = new Chart(document.getElementById('barChart'), {
      type: 'bar',
      data: {
        labels: ['Omzet', 'Energiekost', 'Capaciteitskost', 'Huur'],
        datasets: [{
          label: 'Maand 1 (€)',
          data: [resultaat.omzet, resultaat.energiekost, resultaat.capaciteitskost, resultaat.huurprijs],
          backgroundColor: ['#00FC63', '#005A00', '#373736', '#888']
        }]
      },
      options: { responsive: true, plugins: { legend: { display: false } } }
    });

    if (window.lineChart) window.lineChart.destroy();
    window.lineChart = new Chart(document.getElementById('lineChart'), {
      type: 'line',
      data: {
        labels: Array.from({ length: 144 }, (_, i) => i + 1),
        datasets: [{
          label: 'Cumulatief rendement (€)',
          data: resultaat.grafiek_data,
          borderColor: '#005A00',
          fill: false
        }]
      },
      options: {
        responsive: true,
        scales: { y: { beginAtZero: false } }
      }
    });
  }
  </script>
</body>
</html>
