<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bellade Tool (Basis)</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body style="font-family: sans-serif; background-color: #F5F5F5; padding: 40px; color: #333;">
  <h1>Simpele Bellade-tool</h1>
  <form id="bereken-form">
    <label>Vermogen (kW): <input name="vermogen" value="80" /></label><br/>
    <label>Opstartkost (€): <input name="opstartkost" value="15000" /></label><br/>
    <label>Huurprijs (€): <input name="huurprijs" value="1095" /></label><br/>
    <label>Huurprijs vanaf maand 61 (€): <input name="huurprijs_later" value="275" /></label><br/>
    <label>Starttarief (€): <input name="starttarief" value="2" /></label><br/>
    <label>kWh-prijs (€): <input name="kwhprijs" value="0.7" /></label><br/>
    <label>Parkeertarief (€): <input name="parkeertarief" value="1" /></label><br/>
    <label>Laadsessies per dag: <input name="laadsessies" value="2" /></label><br/>
    <label>Kostprijs energie (€): <input name="kostprijsenergie" value="0.2" /></label><br/>
    <label>Maandelijkse stijging (%): <input name="maandstijging" value="0.005" /></label><br/>
    <label>Verbruik per sessie (kWh): <input name="verbruik_per_sessie" value="39" /></label><br/><br/>
    <button type="button" onclick="bereken()">Start calculatie</button>
  </form>

  <h2>Resultaten</h2>
  <div id="resultaat"></div>
  <canvas id="barChart" height="100"></canvas>
  <canvas id="lineChart" height="200"></canvas>

  <script>
    async function bereken() {
      const formData = new FormData(document.getElementById('bereken-form'));
      const data = Object.fromEntries([...formData.entries()].map(([k, v]) => [k, v.replace(',', '.')]));
      const response = await fetch('/bereken', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      const res = await response.json();
      const el = document.getElementById('resultaat');
      el.innerHTML = `
        Omzet: €${res.omzet}<br/>
        Energiekost: €${res.energiekost}<br/>
        Capaciteitskost: €${res.capaciteitskost}<br/>
        Huur: €${res.huurprijs}<br/>
        Verkochte energie: ${res.energiehoeveelheid} kWh<br/>
        Terugverdentijd: ${res.terugverdentijd} maanden<br/>
        Jaarlijks rendement: ${res.rendement_jaarlijks} %
      `;

      if (window.barChart) window.barChart.destroy();
      window.barChart = new Chart(document.getElementById("barChart"), {
        type: 'bar',
        data: {
          labels: ['Omzet', 'Energiekost', 'Capaciteit', 'Huur'],
          datasets: [{
            label: '€',
            data: [res.omzet, res.energiekost, res.capaciteitskost, res.huurprijs],
            backgroundColor: ['#66cc66', '#ff9966', '#9999ff', '#cccccc']
          }]
        },
        options: { responsive: true, plugins: { legend: { display: false } } }
      });

      if (window.lineChart) window.lineChart.destroy();
      window.lineChart = new Chart(document.getElementById("lineChart"), {
        type: 'line',
        data: {
          labels: Array.from({ length: 144 }, (_, i) => i + 1),
          datasets: [{
            label: 'Cumulatief rendement (€)',
            data: res.grafiek_data,
            borderColor: '#3366cc',
            fill: false,
          }]
        }
      });
    }
  </script>
</body>
</html>
